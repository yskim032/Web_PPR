<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MSC KOREA Performance</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="css/styles.css?v=14">
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-msc">
  <div class="container-fluid px-4">
    <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
      <i class="bi bi-ship fs-4"></i>
      <span class="fw-bold">MSC KOREA Performance</span>
    </a>
    <div class="d-flex align-items-center gap-3">
      <span class="badge bg-light text-dark" id="currentDateTime"></span>
      <button class="btn btn-outline-light btn-sm" id="btnLogin">
        <i class="bi bi-person-circle me-1"></i>Login
      </button>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="container-fluid px-4 py-3">

  <!-- Port Tabs -->
  <ul class="nav nav-tabs port-tabs mb-0" id="portTabs">
    <li class="nav-item">
      <button class="nav-link active" data-port="busan">
        <i class="bi bi-anchor me-1"></i>BUSAN
        <span class="badge bg-primary ms-1" id="badge-busan">0</span>
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-port="gwangyang">
        <i class="bi bi-anchor me-1"></i>GWANGYANG
        <span class="badge bg-primary ms-1" id="badge-gwangyang">0</span>
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-port="incheon">
        <i class="bi bi-anchor me-1"></i>INCHEON
        <span class="badge bg-primary ms-1" id="badge-incheon">0</span>
      </button>
    </li>
  </ul>

  <!-- Tab Content Panel -->
  <div class="tab-panel-box">

    <!-- Toolbar -->
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 p-3 border-bottom bg-light">
      <div class="d-flex align-items-center gap-2">
        <input type="text" class="form-control form-control-sm" id="searchInput"
               placeholder="Search vessel, voyage, service..." style="width:260px">
        <select class="form-select form-select-sm" id="serviceFilter" style="width:200px">
          <option value="">All Services</option>
        </select>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-sm btn-outline-secondary" id="btnImportJSON">
          <i class="bi bi-upload me-1"></i>Import JSON
        </button>
        <button class="btn btn-sm btn-outline-secondary" id="btnImportXML">
          <i class="bi bi-upload me-1"></i>Import XML
        </button>
        <button class="btn btn-sm btn-outline-primary" id="btnExportJSON">
          <i class="bi bi-download me-1"></i>Export JSON
        </button>
        <button class="btn btn-sm btn-outline-success" id="btnExportXML">
          <i class="bi bi-download me-1"></i>Export XML
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-hover vessel-table mb-0" id="vesselTable">
        <colgroup>
          <col style="width:32px">   <!-- # -->
          <col style="width:74px">   <!-- TERMINAL -->
          <col style="width:82px">   <!-- TALLY -->
          <col style="width:300px">  <!-- VESSEL -->
          <col style="width:200px">  <!-- ARRIVAL -->
          <col style="width:200px">  <!-- DEPARTURE -->
          <col style="width:200px">  <!-- SERVICE -->
          <col>                      <!-- MEMO (남은 공간) -->
          <col style="width:46px">   <!-- FILES -->
        </colgroup>
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>TERMINAL</th>
            <th>TALLY</th>
            <th>VESSEL</th>
            <th>ARRIVAL</th>
            <th>DEPARTURE</th>
            <th>SERVICE</th>
            <th class="memo-th">MEMO</th>
            <th>FILES</th>
          </tr>
        </thead>
        <tbody id="vesselTableBody">
          <tr>
            <td colspan="9" class="text-center py-4 text-muted">
              <i class="bi bi-hourglass-split fs-3 d-block mb-2"></i>Loading...
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="d-flex align-items-center justify-content-between p-3 border-top bg-light">
      <div class="text-muted small" id="tableInfo">Showing 0 of 0 vessels</div>
      <nav>
        <ul class="pagination pagination-sm mb-0" id="pagination"></ul>
      </nav>
    </div>
  </div>
</div>

<!-- Vessel Detail Modal -->
<div class="modal fade" id="vesselModal" tabindex="-1" data-bs-backdrop="static">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-msc text-dark">
        <div>
          <h5 class="modal-title mb-0" id="modalVesselName">MSC VESSEL</h5>
          <small id="modalVesselSub" class="opacity-75"></small>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-0">

        <!-- Vessel Info Bar -->
        <div class="vessel-info-bar px-4 py-3">
          <div class="row g-3">
            <div class="col-auto">
              <label class="info-label">PORT</label>
              <div class="info-value" id="infoPort">-</div>
            </div>
            <div class="col-auto">
              <label class="info-label">ARRIVAL</label>
              <div class="info-value" id="infoArrival">-</div>
            </div>
            <div class="col-auto">
              <label class="info-label">DEPARTURE</label>
              <div class="info-value" id="infoDeparture">-</div>
            </div>
            <div class="col-auto">
              <label class="info-label">SERVICE</label>
              <div class="info-value" id="infoService">-</div>
            </div>
            <div class="col-auto">
              <label class="info-label">CONTACT</label>
              <div class="info-value" id="infoContact">-</div>
            </div>
          </div>
        </div>

        <!-- Detail Tabs -->
        <ul class="nav nav-tabs detail-tabs px-4 pt-2" id="detailTabs">
          <li class="nav-item">
            <button class="nav-link active" data-tab="overview">
              <i class="bi bi-grid me-1"></i>Overview
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-tab="ppr">
              <i class="bi bi-bar-chart me-1"></i>PPR
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-tab="discharge">
              <i class="bi bi-box-arrow-in-down me-1"></i>Discharge List
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-tab="load">
              <i class="bi bi-box-arrow-up me-1"></i>Load List
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-tab="shifting">
              <i class="bi bi-arrow-left-right me-1"></i>Shifting List
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-tab="other">
              <i class="bi bi-paperclip me-1"></i>Other Files
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="p-4" id="detailTabContent">

          <!-- Overview Tab -->
          <div class="tab-content-panel active" id="tab-overview">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="card border-0 shadow-sm">
                  <div class="card-header bg-msc text-white">
                    <i class="bi bi-box-seam me-2"></i>Container Summary
                  </div>
                  <div class="card-body">
                    <div class="row text-center g-2">
                      <div class="col-6">
                        <div class="stat-box border rounded p-2">
                          <div class="stat-number text-primary" id="statDischarge">-</div>
                          <div class="stat-label">DISCHARGE</div>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="stat-box border rounded p-2">
                          <div class="stat-number text-success" id="statLoad">-</div>
                          <div class="stat-label">LOAD</div>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="stat-box border rounded p-2">
                          <div class="stat-number text-warning" id="statShifting">-</div>
                          <div class="stat-label">SHIFTING</div>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="stat-box border rounded p-2">
                          <div class="stat-number text-danger" id="statTotal">-</div>
                          <div class="stat-label">TOTAL MOVES</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card border-0 shadow-sm">
                  <div class="card-header bg-msc text-white">
                    <i class="bi bi-chat-left-text me-2"></i>Superuser Memo
                  </div>
                  <div class="card-body">
                    <textarea class="form-control" id="memoArea" rows="5"
                              placeholder="Enter memo here..." style="resize:none"></textarea>
                    <button class="btn btn-sm btn-primary mt-2" id="btnSaveMemo">
                      <i class="bi bi-save me-1"></i>Save Memo
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-12">
                <div class="card border-0 shadow-sm">
                  <div class="card-header bg-msc text-white">
                    <i class="bi bi-clock-history me-2"></i>Port Operations Timeline
                  </div>
                  <div class="card-body">
                    <div class="row g-2">
                      <div class="col-md-3">
                        <label class="form-label small fw-bold">Berthing</label>
                        <input type="datetime-local" class="form-control form-control-sm" id="timeBerthing">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label small fw-bold">Discharge Commence</label>
                        <input type="datetime-local" class="form-control form-control-sm" id="timeDischargeStart">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label small fw-bold">Load Commence</label>
                        <input type="datetime-local" class="form-control form-control-sm" id="timeLoadStart">
                      </div>
                      <div class="col-md-3">
                        <label class="form-label small fw-bold">Sailing</label>
                        <input type="datetime-local" class="form-control form-control-sm" id="timeSailing">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- PPR Tab -->
          <div class="tab-content-panel" id="tab-ppr">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="fw-bold mb-0">
                <i class="bi bi-bar-chart me-2"></i>Performance Report (PPR)
              </h6>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-primary" id="btnOpenPPR">
                  <i class="bi bi-pencil-square me-1"></i>Edit Full PPR
                </button>
                <button class="btn btn-sm btn-outline-secondary" id="btnExportPPRJSON">
                  <i class="bi bi-download me-1"></i>JSON
                </button>
                <button class="btn btn-sm btn-outline-success" id="btnExportPPRXML">
                  <i class="bi bi-download me-1"></i>XML
                </button>
              </div>
            </div>
            <div class="ppr-preview" id="pprPreview">
              <div class="text-center text-muted py-5">
                <i class="bi bi-file-earmark-bar-graph fs-1 d-block mb-2"></i>
                No PPR data yet. Click "Edit Full PPR" to create one.
              </div>
            </div>
          </div>

          <!-- Discharge List Tab -->
          <div class="tab-content-panel" id="tab-discharge">
            <div class="file-upload-section">
              <h6 class="fw-bold mb-3"><i class="bi bi-box-arrow-in-down me-2"></i>Discharge List</h6>
              <div class="upload-zone" id="dropDischarge">
                <i class="bi bi-cloud-upload fs-2 d-block mb-2 text-muted"></i>
                <p class="text-muted mb-2">Drop file here or click to upload</p>
                <input type="file" class="d-none" id="fileDischarge" accept=".xls,.xlsx,.pdf,.csv">
                <button class="btn btn-outline-primary btn-sm" onclick="document.getElementById('fileDischarge').click()">
                  <i class="bi bi-folder2-open me-1"></i>Browse File
                </button>
                <p class="text-muted small mt-2">Supports: XLS, XLSX, PDF, CSV</p>
              </div>
              <div id="dischargeFileList" class="mt-3"></div>
            </div>
          </div>

          <!-- Load List Tab -->
          <div class="tab-content-panel" id="tab-load">
            <div class="file-upload-section">
              <h6 class="fw-bold mb-3"><i class="bi bi-box-arrow-up me-2"></i>Load List</h6>
              <div class="upload-zone" id="dropLoad">
                <i class="bi bi-cloud-upload fs-2 d-block mb-2 text-muted"></i>
                <p class="text-muted mb-2">Drop file here or click to upload</p>
                <input type="file" class="d-none" id="fileLoad" accept=".xls,.xlsx,.pdf,.csv">
                <button class="btn btn-outline-success btn-sm" onclick="document.getElementById('fileLoad').click()">
                  <i class="bi bi-folder2-open me-1"></i>Browse File
                </button>
                <p class="text-muted small mt-2">Supports: XLS, XLSX, PDF, CSV</p>
              </div>
              <div id="loadFileList" class="mt-3"></div>
            </div>
          </div>

          <!-- Shifting List Tab -->
          <div class="tab-content-panel" id="tab-shifting">
            <div class="file-upload-section">
              <h6 class="fw-bold mb-3"><i class="bi bi-arrow-left-right me-2"></i>Shifting List</h6>
              <div class="upload-zone" id="dropShifting">
                <i class="bi bi-cloud-upload fs-2 d-block mb-2 text-muted"></i>
                <p class="text-muted mb-2">Drop file here or click to upload</p>
                <input type="file" class="d-none" id="fileShifting" accept=".xls,.xlsx,.pdf,.csv">
                <button class="btn btn-outline-warning btn-sm" onclick="document.getElementById('fileShifting').click()">
                  <i class="bi bi-folder2-open me-1"></i>Browse File
                </button>
                <p class="text-muted small mt-2">Supports: XLS, XLSX, PDF, CSV</p>
              </div>
              <div id="shiftingFileList" class="mt-3"></div>
            </div>
          </div>

          <!-- Other Files Tab -->
          <div class="tab-content-panel" id="tab-other">
            <div class="file-upload-section">
              <h6 class="fw-bold mb-3"><i class="bi bi-paperclip me-2"></i>Other Files</h6>
              <div class="upload-zone" id="dropOther">
                <i class="bi bi-cloud-upload fs-2 d-block mb-2 text-muted"></i>
                <p class="text-muted mb-2">Drop files here or click to upload</p>
                <input type="file" class="d-none" id="fileOther" multiple accept=".xls,.xlsx,.pdf,.csv,.doc,.docx">
                <button class="btn btn-outline-secondary btn-sm" onclick="document.getElementById('fileOther').click()">
                  <i class="bi bi-folder2-open me-1"></i>Browse Files
                </button>
                <p class="text-muted small mt-2">Supports: XLS, XLSX, PDF, CSV, DOC, DOCX</p>
              </div>
              <div id="otherFileList" class="mt-3"></div>
            </div>
          </div>

        </div><!-- /detailTabContent -->
      </div><!-- /modal-body -->

      <div class="modal-footer bg-light">
        <div class="d-flex gap-2 me-auto">
          <button class="btn btn-sm btn-outline-primary" id="btnExportVesselJSON">
            <i class="bi bi-download me-1"></i>Export JSON
          </button>
          <button class="btn btn-sm btn-outline-success" id="btnExportVesselXML">
            <i class="bi bi-download me-1"></i>Export XML
          </button>
        </div>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header bg-msc text-white">
        <h5 class="modal-title"><i class="bi bi-person-lock me-2"></i>Login</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label small">Email</label>
          <input type="email" class="form-control" id="loginEmail" placeholder="user@msc.com">
        </div>
        <div class="mb-3">
          <label class="form-label small">Password</label>
          <input type="password" class="form-control" id="loginPassword">
        </div>
        <div id="loginError" class="text-danger small d-none"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary w-100" id="btnDoLogin">
          <i class="bi bi-box-arrow-in-right me-1"></i>Login
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Import File Input (hidden) -->
<input type="file" id="importFileInput" class="d-none" accept=".json,.xml">

<!-- Toast Notifications -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="appToast" class="toast align-items-center text-white border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="toastMessage"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- Firebase SDK -->
<script type="module" src="js/firebase-config.js?v=11"></script>
<script type="module" src="js/app.js?v=11"></script>
</body>
</html>
